<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="normalize.css">
  <link rel="stylesheet" href="index.css">
  <title>餐廳官網</title>
  <style>
    
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="wrapper">
      <div class="navbar__site-name">
        Just A Bite!
      </div>
      <ul class="navbar__list">
        <li class="active"><a href="#">抽個大獎</a></li>
        <li><a href="#">我要點餐</a></li>
        <li><a href="#">查詢訂單</a></li>
        <li><a href="#">常見問題</a></li>
      </ul>
    </div>
  </nav>
  <section class="wrapper free-prize">
    <div class="free-prize-content">
      <div class="free-prize-content-notice">
        <h2 class="free-prize-title">2020 夏日輕盈特賞！ 抽獎活動辦法</h2>
        <div class="free-prize-timing">
          <h3>活動期間：</h3>
          <p>2020/06/01~2020/07/01</p>
        </div>
        <div class="free-prize-desc">
          <h3>活動說明：</h3>
          <p>今天老闆佛心來著決定給大家發獎勵，有看有機會，沒看只能幫QQ！只要在店內消費滿1000000元即有機會獲得 - 頭獎日本東京來回雙人遊！</p>
        </div>
        <div class="free-prize-award">
          <h3>獎  品：</h3>
          <div class="free-prize-award-details">
          <p>❤ 頭獎一名：日本東京來回雙人遊(市價14990元)</p>
          <p>❤ 貳獎三名：90 吋電視一台(市價5990元)</p>
          <p>❤ 參獎十名：知名 YouTuber 簽名握手會入場券一張(市價1500元)</p>
        </div>
      </div>
      <button class="btn" type="button">我要抽獎</button>
    </div>
  </section>
  <footer>
    <div class="footer__top">
      <div class="wrapper">
        <div class="footer__info">  
          <div class="address">餐館地址: 天上地下天堂路三分之一里六段520號</div>
          <div class="tel">訂位專線：02-1314-5566</div>
          <div class="open__time">營業時間：週一〜週五 09:00~18:00 / 週六、週日、國定假日（含連假）休息</div>
          <div class="email">email：service@justabite.com.tw</div>
        </div>
        <div class="footer__site">
          <div class="site-name">Just A Bite!</div>
          <div class="link"><a href="#">Facebook / Instagram / Youtube</a></div>
        </div>
      </div>
    </div>
    <div class="footer__bottom">
      Copyright © 2020 Just A Bite All Rights Reserved. 咬一口股份有限公司版權所有
    </div>
  </footer>
  <script>
    const apiURL = 'https://dvwhnbka7d.execute-api.us-east-1.amazonaws.com/default/lottery';
    const errorMessage = '系統不穩定，請再試一次';
    // 抽獎， 如果有錯誤就會放在第一個參數，如果沒有錯誤就會把資料放在第二個參數
    function getPrize(callback) {
      const request = new XMLHttpRequest();
      request.open('GET', apiURL, true);
      request.addEventListener('load', function() {
        const response = request.responseText;
        if (request.status >= 200 && request.status < 400) {
          let data
          try {
            data = JSON.parse(response);
          } catch(err) {
            callback(errorMessage);
            return;
          }
          if (!data.prize) {
            callback(errorMessage);
            return;
          }
          // null 沒有錯誤， data 回傳
          callback(null, data) 
        } else {
          callback(errorMessage);
        }
      })
      request.onerror = function() {
        callback(errorMessage);
            return;
      }
      request.send();
    }

    document.querySelector('.free-prize').addEventListener('click', () => {
      // call API 抽獎
      getPrize(function(err, data){
        // 如果有錯誤，就會跳出通知，return 終止執行
        if (err) {
          alert(err);
          return
        }
        // 如果沒有錯誤，就會執行以下畫面顯示
        const container = document.querySelector('.free-prize');
        const prize = data.prize;
      
        if (prize === 'FIRST') {
          document.querySelector('.free-prize').removeChild(document.querySelector('.free-prize-content'));
          const newFreePrize = document.createElement('div')
          newFreePrize.classList.add('free-prize-content')
          newFreePrize.classList.add('first')
          newFreePrize.innerHTML = `    
            <h2 class="free-prize-title">恭喜你中頭獎了！日本東京來回雙人遊！</h2>
            <button class="btn">我要抽獎</button>`
          container.appendChild(newFreePrize);
          } else if (prize === 'SECOND') {
            document.querySelector('.free-prize').removeChild(document.querySelector('.free-prize-content'))
            const newFreePrize = document.createElement('div')
            newFreePrize.classList.add('free-prize-content')
            newFreePrize.classList.add('second')
            newFreePrize.innerHTML = `    
              <h2 class="free-prize-title">二獎！90 吋電視一台！</h2>
              <button class="btn">我要抽獎</button>`
              container.appendChild(newFreePrize);
          } else if (prize === 'THIRD') {
            document.querySelector('.free-prize').removeChild(document.querySelector('.free-prize-content'))
            const newFreePrize = document.createElement('div')
            newFreePrize.classList.add('free-prize-content')
            newFreePrize.classList.add('third')
            newFreePrize.innerHTML = `    
              <h2 class="free-prize-title">恭喜你抽中三獎：知名 YouTuber 簽名握手會入場券一張，bang！</h2>
              <button class="btn">我要抽獎</button>`
              container.appendChild(newFreePrize);
          } else if (prize === 'NONE') {
            document.querySelector('.free-prize').removeChild(document.querySelector('.free-prize-content'))
            const newFreePrize = document.createElement('div')
            newFreePrize.classList.add('free-prize-content')
            newFreePrize.classList.add('none')
            newFreePrize.innerHTML = `    
              <h2 class="free-prize-title">銘謝惠顧</h2>
              <button class="btn">我要抽獎</button>`
              container.appendChild(newFreePrize);
          }
      })
    })
    
  </script>
</body>
</html>